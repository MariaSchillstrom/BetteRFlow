@page "/admin/statistics"
@inject IHttpClientFactory HttpClientFactory
@rendermode InteractiveServer

<h2>📊 Statistik</h2>

@if (isLoading)
{
    <p>Laddar statistik…</p>
}
else
{
    <ul>
        <li><strong>Totalt antal sidbesök:</strong> @TotalPageViews</li>
        <li><strong>Sidbesök idag:</strong> @PageViewsToday</li>
    </ul>

    <div class="alert alert-info mt-3">
        <strong>ℹ️ Om statistiken</strong><br />
        Statistiken lagras i <strong>UTC</strong> i databasen.<br />
        Dagssummering baseras därför på serverns dygn, inte lokal tid.<br />
        <em>Nästa steg är att lägga ett tidszonslager per användare.</em>
    </div>
}
}

@code {
    private int TotalPageViews;
    private int PageViewsToday;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var client = HttpClientFactory.CreateClient("ApiClient");

        var stats = await client.GetFromJsonAsync<StatsDto>(
            "api/admin/statistics");

        TotalPageViews = stats!.TotalPageViews;
        PageViewsToday = stats.PageViewsToday;

        isLoading = false;
    }

    private class StatsDto
    {
        public int TotalPageViews { get; set; }
        public int PageViewsToday { get; set; }
    }
}
